---
id: 0001
title: update-phase3-ai-chatbot
stage: constitution
date: 2026-01-14
surface: agent
model: claude-sonnet-4-5-20250929
feature: none
branch: main
user: hc
command: sp.constitution
labels: ["constitution","phase3","ai-chatbot","todo-app"]
links:
  spec: null
  ticket: null
  adr: null
  pr: null
files:
 - .specify/memory/constitution.md
tests:
 - none
---

## Prompt

You are the system architect evolving the Hackathon II "Evolution of Todo" project to Phase 3: Todo AI Chatbot.

The project lives in the existing folder ~/hackathon-todo and the same GitHub repo: https://github.com/aimanarshad/Hackathon-Todo-App

IMPORTANT: You MUST NOT delete, modify, or overwrite ANY files or code from Phase 1 or Phase 2. All previous work (frontend Next.js app, backend FastAPI with tasks API, Neon DB Task model, etc.) must remain exactly as is. Only ADD new files and folders.

Generate an UPDATED constitution.md that extends the current one.

New Phase 3 Principles:
- Add a conversational AI chatbot interface to the existing full-stack Todo web app.
- Users manage tasks via natural language (add, list, complete, delete, update).
- Use Google Gemini (gemini-1.5-flash or gemini-1.5-pro) via google-generativeai + LangChain for agentic logic and function calling.
- Implement MCP-style server: FastAPI exposes stateless task tools (add_task, list_tasks, complete_task, delete_task, update_task).
- Stateless chat endpoint: POST /api/chat (or /api/{user_id}/chat) that persists conversation history in Neon DB.
- Conversation state stored in new DB models: Conversation and Message (do not touch existing Task model).
- Agent uses tools to interact with existing tasks API or directly with DB.
- No authentication yet (can use dummy user_id for now).

Tech Stack Additions (only add, do not remove anything):
- google-generativeai
- langchain, langchain-google-genai, langchain-core
- Use GEMINI_API_KEY from backend/.env

Repository Structure (add only):
- backend/agents/ â†’ Gemini + LangChain agent logic
- backend/mcp/ â†’ MCP tool functions
- backend/conversation_models.py â†’ Conversation and Message models
- backend/routers/chat.py â†’ chat endpoint
- frontend/app/chat/page.tsx â†’ Chat interface (or similar)

Output ONLY the full updated Markdown content for constitution.md.
Start with # Project Constitution: Evolution of Todo - Phase 3 AI Chatbot

## Response snapshot

# Project Constitution: Evolution of Todo - Phase 3 AI Chatbot

## Vision
We are building a single Todo application that evolves iteratively across all hackathon phases.
Phase 1 delivered an in-memory console application.
Phase 2 transformed it into a persistent, multi-user, full-stack web application using modern cloud-native technologies â€” all driven strictly by specifications and AI-generated code.
Phase 3 adds a conversational AI chatbot interface that allows users to manage tasks via natural language, using Google Gemini and LangChain for agentic logic and function calling.

The final goal remains a cloud-native AI-powered chatbot on Kubernetes (Phases 3â€“5), but every phase must build directly on the previous one in the same monorepo.

## Core Guiding Principles
- **Spec-Driven Development Only**: No manual coding is permitted at any stage. All implementation code must be generated by Claude from refined Markdown specifications and this constitution.
- **Iterative Evolution**: Each phase extends and enhances the same application. Phase 1 logic and data model serve as the foundation.
- **Clean Architecture**: Strict separation of concerns â€” backend handles data, business logic, and persistence; frontend handles presentation and user experience.
- **Simplicity & Extensibility**: Keep components minimal yet designed for future phases (AI agents, containerization, event-driven architecture).
- **User-Centric**: The application must remain intuitive and responsive at every stage.
- **Monorepo Structure**: Everything lives in one repository with clear folder organization.
- **Backward Compatibility**: All existing functionality from Phases 1 and 2 must remain intact and operational.

## Phase 3 Specific Principles
- **Conversational AI Interface**: Add a conversational AI chatbot interface to the existing full-stack Todo web app that allows users to manage tasks via natural language.
- **Natural Language Task Management**: Users manage tasks via natural language commands (add, list, complete, delete, update).
- **Google Gemini Integration**: Use Google Gemini (gemini-1.5-flash or gemini-1.5-pro) via google-generativeai + LangChain for agentic logic and function calling.
- **MCP-Style Server**: Implement MCP-style server: FastAPI exposes stateless task tools (add_task, list_tasks, complete_task, delete_task, update_task).
- **Stateless Chat Endpoint**: Implement stateless chat endpoint: POST /api/chat (or /api/{user_id}/chat) that persists conversation history in Neon DB.
- **Conversation State Management**: Conversation state stored in new DB models: Conversation and Message (do not touch existing Task model).
- **Agent Tool Integration**: Agent uses tools to interact with existing tasks API or directly with DB.
- **No Authentication Yet**: Use dummy user_id for now, authentication will be added in later phases.
- **Preserve Existing Functionality**: All Phase 1 and Phase 2 features must remain fully functional and unchanged.

## Technology Stack (Phase 3 - Added to Phase 2 Stack)
- **Phase 2 Stack Remains Intact**:
  - Backend: FastAPI, SQLModel, Uvicorn, psycopg2-binary, python-dotenv
  - Database: Neon Serverless PostgreSQL
  - Frontend: Next.js 14+, TypeScript, Tailwind CSS, React Server Components
  - Project Management: UV, npm/pnpm/yarn

- **Phase 3 Additions**:
  - **AI & LangChain**:
    - google-generativeai
    - langchain
    - langchain-google-genai
    - langchain-core
  - **Environment**: Use GEMINI_API_KEY from backend/.env

## Data Model Evolution (Added to Phase 2 Model)
- **Phase 2 Task Model Remains Intact**:
  - `id`: Integer primary key (auto-generated)
  - `title`: String (required)
  - `description`: String (optional)
  - `completed`: Boolean (default False)
  - `priority`: String/Enum ("high", "medium", "low", null)
  - `tags`: Array/String (e.g., "work", "personal")
  - `created_at`, `updated_at`: Timestamps
  - `user_id`: Integer (nullable now, required later for multi-user)

- **Phase 3 Additions**:
  - **Conversation Model**:
    - `id`: Integer primary key (auto-generated)
    - `user_id`: Integer (foreign key to user, or dummy for now)
    - `title`: String (summary of conversation)
    - `created_at`: Timestamp
    - `updated_at`: Timestamp
  - **Message Model**:
    - `id`: Integer primary key (auto-generated)
    - `conversation_id`: Integer (foreign key to conversation)
    - `role`: String ("user" or "assistant")
    - `content`: Text (message content)
    - `timestamp`: Timestamp
    - `metadata`: JSON (optional metadata for AI interactions)

## Constraints & Rules
- All new features must have corresponding Markdown specs in `/specs/` before implementation.
- Refine specifications iteratively until Claude generates correct, working code.
- Backend must expose clean REST endpoints (existing from Phase 2 plus new chat endpoints).
- Frontend must fetch and mutate data via these API endpoints (no direct DB access).
- Environment-sensitive values (DATABASE_URL, GEMINI_API_KEY) must stay in `.env` and never be committed.
- Code must follow PEP 8 (backend) and ESLint/Prettier standards (frontend).
- Error handling must be graceful on both client and server.
- **Phase 3 Specific**: AI chat functionality must not break existing web interface functionality.
- **Security**: API keys must be properly secured and never exposed to frontend.
- **State Management**: Conversation state must persist reliably in the database.

## Repository Structure (Updated Monorepo)
hackathon-todo/
â”œâ”€â”€ frontend/              â† Next.js TypeScript app (App Router, Tailwind) - Phase 2 content preserved
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ chat/          â† Phase 3: New chat interface (page.tsx, components)
â”‚   â”‚   â””â”€â”€ tasks/         â† Phase 2: Existing tasks interface
â”‚   â””â”€â”€ ...                â† Phase 2: Other existing files preserved
â”œâ”€â”€ backend/               â† FastAPI + SQLModel application - Phase 2 content preserved
â”‚   â”œâ”€â”€ agents/            â† Phase 3: Gemini + LangChain agent logic
â”‚   â”œâ”€â”€ mcp/               â† Phase 3: MCP tool functions
â”‚   â”œâ”€â”€ routers/
â”‚   â”‚   â”œâ”€â”€ tasks.py       â† Phase 2: Existing tasks router
â”‚   â”‚   â””â”€â”€ chat.py        â† Phase 3: New chat endpoint router
â”‚   â”œâ”€â”€ models/            â† Phase 2: Existing models preserved
â”‚   â”œâ”€â”€ conversation_models.py  â† Phase 3: Conversation and Message models
â”‚   â””â”€â”€ ...                â† Phase 2: Other existing files preserved
â”œâ”€â”€ specs/                 â† All specification history (Phase 1 + Phase 2 + Phase 3)
â”œâ”€â”€ src/                   â† Phase 1 console code (kept for historical reference)
â”œâ”€â”€ .specify/memory/       â† Project constitution and templates
â”œâ”€â”€ CLAUDE.md              â† Prompting guidelines for Claude
â”œâ”€â”€ README.md              â† Project overview and run instructions
â””â”€â”€ .env                   â† Local only (DATABASE_URL, GEMINI_API_KEY, never commit)

## Development Workflow
1. Update/extend constitution (this file).
2. Write detailed specification (WHAT).
3. Create plan (HOW).
4. Break into atomic tasks.
5. Generate implementation via Claude Code (Phase 3 backend first: agents, tools, chat endpoints, then frontend chat UI).
6. Test locally, refine specs if needed.
7. Ensure all Phase 1 and Phase 2 functionality remains intact.
8. Commit with clear message linking to spec/task.

## Commitment
We adhere strictly to spec-driven development throughout the entire evolution.
Every line of new code in Phase 3 and beyond shall originate from refined specifications interpreted by Claude â€” ensuring architectural integrity, traceability, and excellence worthy of Panaversity evaluation.

Phase 3 builds upon the solid foundation of Phases 1 and 2, adding AI capabilities while maintaining all existing functionality. We commit to preserving backward compatibility and extending the application in a principled, specification-driven manner.

This constitution governs Phase 3 and will be further evolved in subsequent phases.

## Outcome

- âœ… Impact: Updated project constitution to include Phase 3 AI Chatbot principles while preserving all previous functionality
- ğŸ§ª Tests: none
- ğŸ“ Files: Updated .specify/memory/constitution.md with new Phase 3 content
- ğŸ” Next prompts: Implementation of Phase 3 features according to the new constitution
- ğŸ§  Reflection: Successfully extended the constitution to cover Phase 3 requirements while maintaining backward compatibility commitments

## Evaluation notes (flywheel)

- Failure modes observed: none
- Graders run and results (PASS/FAIL): not applicable
- Prompt variant (if applicable): not applicable
- Next experiment (smallest change to try): Begin implementing Phase 3 features according to the new constitution
